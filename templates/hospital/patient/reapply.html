{% extends 'hospital/patient/base.html' %}
{% block content %}

<div class="container-fluid py-4 px-4">
  <div class="section-header mb-4">
    <h2 style="font-family:'Cormorant Garamond',serif;color:#1a1a2e;margin:0;">
      <i class="fas fa-redo" style="color:#c9a84c;margin-right:10px;"></i>Reapply for Treatment
    </h2>
    <p class="text-muted mt-1 mb-0">Submit a new treatment request after discharge</p>
  </div>

  {% if messages %}
  {% for message in messages %}
  <div class="alert alert-{{ message.tags }}" style="border-radius:12px;border:none;font-size:14px;padding:15px 18px;margin-bottom:20px;
    {% if message.tags == 'success' %}background:linear-gradient(135deg,#d4edda,#c3e6cb);color:#155724;{% elif message.tags == 'error' %}background:#fff3f3;color:#c0392b;{% else %}background:#fff3cd;color:#856404;{% endif %}">
    <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'error' %}fa-times-circle{% else %}fa-exclamation-triangle{% endif %} mr-2"></i> {{ message }}
  </div>
  {% endfor %}
  {% endif %}

  <div class="row justify-content-center">
    <div class="col-lg-8">
      <!-- Previous Discharge Info -->
      <div class="card border-0 shadow-sm mb-4" style="border-top:4px solid #FF6B6B!important;border-radius:12px;">
        <div style="background:linear-gradient(135deg,#1a1a2e,#0f3460);padding:15px 20px;border-radius:12px 12px 0 0;">
          <h6 style="color:#c9a84c;margin:0;font-family:'Cormorant Garamond',serif;font-size:18px;">
            <i class="fas fa-file-medical-alt mr-2"></i>Previous Discharge Summary
          </h6>
        </div>
        <div class="card-body p-4">
          <div class="row">
            <div class="col-md-6 mb-3">
              <div style="background:#f8f9fa;border-radius:10px;padding:15px;border-left:4px solid #0f3460;">
                <small style="color:#888;text-transform:uppercase;font-weight:600;font-size:11px;">Attending Doctor</small>
                <div style="font-weight:600;color:#1a1a2e;margin-top:4px;">Dr. {{lastDischarge.assignedDoctorName}}</div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div style="background:#f8f9fa;border-radius:10px;padding:15px;border-left:4px solid #c9a84c;">
                <small style="color:#888;text-transform:uppercase;font-weight:600;font-size:11px;">Previous Symptoms</small>
                <div style="font-weight:600;color:#1a1a2e;margin-top:4px;">{{lastDischarge.symptoms}}</div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div style="background:#f8f9fa;border-radius:10px;padding:15px;border-left:4px solid #2a9d8f;">
                <small style="color:#888;text-transform:uppercase;font-weight:600;font-size:11px;">Discharge Date</small>
                <div style="font-weight:600;color:#1a1a2e;margin-top:4px;">{{lastDischarge.releaseDate}}</div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div style="background:#f8f9fa;border-radius:10px;padding:15px;border-left:4px solid #6C5CE7;">
                <small style="color:#888;text-transform:uppercase;font-weight:600;font-size:11px;">Days Spent</small>
                <div style="font-weight:600;color:#1a1a2e;margin-top:4px;">{{lastDischarge.daySpent}} days</div>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <div style="background:#f8f9fa;border-radius:10px;padding:15px;border-left:4px solid #FF6B6B;">
                <small style="color:#888;text-transform:uppercase;font-weight:600;font-size:11px;">Total Bill</small>
                <div style="font-weight:600;color:#1a1a2e;margin-top:4px;">&#8377; {{lastDischarge.total}}</div>
              </div>
            </div>
          </div>
          {% if lastDischarge.followUpNotes %}
          <div class="alert mt-2" style="border-radius:10px;background:#f0f0ff;border:1px solid #6C5CE7;color:#333;font-size:14px;">
            <i class="fas fa-sticky-note mr-2" style="color:#6C5CE7;"></i>
            <strong>Doctor's Follow-up Notes:</strong> {{lastDischarge.followUpNotes}}
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Reapply Form -->
      <div class="card border-0 shadow-sm" style="border-top:4px solid #2a9d8f!important;border-radius:12px;">
        <div style="background:linear-gradient(135deg,#1a1a2e,#0f3460);padding:15px 20px;border-radius:12px 12px 0 0;">
          <h6 style="color:#c9a84c;margin:0;font-family:'Cormorant Garamond',serif;font-size:18px;">
            <i class="fas fa-plus-circle mr-2"></i>New Treatment Request
          </h6>
        </div>
        <div class="card-body p-4">
          <form method="post">
            {% csrf_token %}
            <div class="form-group">
              <label style="color:#333;font-weight:600;font-size:12px;text-transform:uppercase;letter-spacing:0.5px;">
                Current Symptoms / Reason for Reapplication
              </label>
              <textarea name="symptoms" class="form-control" rows="4" required
                        placeholder="Describe your current symptoms or reason for seeking treatment again..."
                        style="border:2px solid #e8e8e8;border-radius:10px;padding:15px;font-size:14px;">{{patient.symptoms}}</textarea>
            </div>
            <div class="alert" style="border-radius:10px;background:#fff8e1;border:1px solid #c9a84c;color:#856404;font-size:13px;">
              <i class="fas fa-info-circle mr-2"></i>
              After submission, your request will need to be approved by the admin before you can access the dashboard again.
            </div>
            <button type="submit" class="btn btn-block" style="background:linear-gradient(135deg,#2a9d8f,#44A08D);color:#fff;border-radius:10px;padding:13px;font-weight:700;font-size:15px;text-transform:uppercase;letter-spacing:1.5px;border:none;">
              <i class="fas fa-paper-plane mr-2"></i>Submit Reapplication
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %}
